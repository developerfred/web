{% comment %}
  Copyright (C) 2020 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load static humanize i18n grants_extra %}
<div class="mx-0 ml-md-5 px-0 pl-md-3 pr-md-4">
  <div id="project-profile-tabs" class="tab-container font-body mt-2 mb-2">

    <button type="button" id="nav-description" href="{{project.url}}?tab=description" class="section-tab {% if tab == "description" %} active {% endif %}">
      {% trans "SUMMARY" %}
    </button>

    <button type="button" id="nav-stats" href="{{project.url}}?tab=stats" class="section-tab {% if tab == "stats" %} active {% endif %}">
      {% trans "STATS" %}
    </button>

    {% if is_staff %}
    <button type="button" id="nav-contributors" href="{{grant.url}}?tab=sybil_profile" class="section-tab {% if tab == "sybil_profile" %} active {% endif %}">
      {% trans "SYBIL PROFILE" %}
    </button>
    {% endif %}

  </div>

  <div id="project-profile-tabs-sections" class="tab-sections section pt-2">

    {% if tab == "activity" %}
      <div id="section-nav-activity" class="tab-section active">
        {% if is_team_member %}
          {% include 'profiles/status_box.html' with suppress_tags=1 placeholder="Update Project's Funders" what="grant" whatid=grant.pk max_length=1000 suppress_data_toggle=1  %}
        {% else %}
          {% include 'profiles/status_box.html' with suppress_tags=1 placeholder="Write on Project wall" what="grant" whatid=grant.pk  suppress_data_toggle=1 %}
        {% endif %}
        <div id="activities" class="activity_stream container px-0">
          {% include 'shared/activity_container.html' with pinned=False %}
        </div>

      </div>
    {% endif %}

    {% if tab == "description" %}
      <div id="section-nav-description" class="tab-section active">
        <h4 class="m-0 p-0">Description</h4>
        <div id="editor">
          {% if summary %}
            {{ summary}}
          {% else %}
            {{ grant.description }}
          {% endif %}
        </div>
      </div>
      <h4 class="m-0 p-0">Activity Feed</h4>
      {% if is_team_member %}
        {% include 'profiles/status_box.html' with suppress_tags=1 placeholder="Update Grant's Funders" what="grant" whatid=grant.pk max_length=1000 suppress_data_toggle=1  %}
      {% else %}
        {% include 'profiles/status_box.html' with suppress_tags=1 placeholder="Write on grants wall" what="grant" whatid=grant.pk  suppress_data_toggle=1 %}
      {% endif %}
      <div id="activities" class="activity_stream container px-0">
        {% include 'shared/activity_container.html' with pinned=False %}
      </div>
    {% endif %}

    {% if tab == "stats" %}
      <script src="https://www.gstatic.com/charts/loader.js"></script>
      <script src="{% static "v2/js/grants/stats.js" %}"></script>
      <div id=grant_stats_graph class="content-block content-block--white">
        <div class="container">

          <div class="value-container">
            <div class="chart_container chart_container--big">
              <p class="sub-title font-weight-semibold font-caption mb-1 pt-1">CONTRIBUTION HISTORY OVER TIME</p>
              <div class="chart_container__content">
                <div id="grant_chart"></div>
              </div>
            </div>
          </div>
          <script>
            const max_graph = {{max_graph}};
            const history = {{history|safe}};
          </script>
        </div>
      </div>
    {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  {% with description_tab_url=grant.url|addstr:'?tab=description' %}
      let grant_description;

      {% if tab == 'description' %}
        grant_description = new Quill('#editor', {
            theme: 'bubble',
            readOnly: true,
          });

        {% if is_team_member and not grant_is_inactive %}
          grant_description = new Quill('#editor', {
            theme: 'snow',
          });
          grant_description.enable(false);
        {% endif %}

        let desc = JSON.parse(grant_description.getContents().ops[0].insert);
        if (desc.ops) {
          grant_description.setContents(desc);
        }
      {% endif %}
  {% endwith %}
</script>